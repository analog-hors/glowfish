use cozy_chess::*;

use crate::wasm4::*;

macro_rules! sprite {
    (($width:expr,$height:expr) $($pixel:tt)*) => {{
        const DATA: [u8; $width * $height] = {
            let mut data = [0; $width * $height];
            let mut data_index = 0;
            let mut bit_index = 4;
            $(
                bit_index -= 1;
                data[data_index] |= sprite!(@pixel $pixel) << (bit_index * 2);
                if bit_index == 0 {
                    bit_index = 4;
                    data_index += 1;
                }
            )*
            let _ = data_index;
            let _ = bit_index;
            data
        };
        TwoBppSprite::new(&DATA, $width, $height)
    }};

    (@pixel .) => { 0 };

    (@pixel #) => { 1 };

    (@pixel @) => { 2 };
}

macro_rules! piece_sprite {
    ($($pixel:tt)*) => {
        sprite! {
            (14, 14)
            $($pixel)*
        }
    }
}

pub const PIECE_SPRITES: [TwoBppSprite; Piece::NUM] = [
    piece_sprite! {
        . . . . . . . . . . . . . .
        . . . . . . . . . . . . . .
        . . . . . # # # # . . . . .
        . . . . # # # # # # . . . .
        . . . . # # # # # # . . . .
        . . . . # # # # # # . . . .
        . . . . . # # # # . . . . .
        . . . # # # # # # # # . . .
        . . . . . # # # # . . . . .
        . . . . . # # # # . . . . .
        . . . . . # # # # . . . . .
        . . . # # # # # # # # . . .
        . . # # # # # # # # # # . .
        . . # # # # # # # # # # . .
    },
    piece_sprite! {
        . . . . . . . . # # . . . .
        . . . . . # # # # # . . . .
        . . . . # # # # # # . . . .
        . . . # # @ # # # # # . . .
        . . # # # # # # # # # . . .
        . . # # # # # # # # # . . .
        . . # # # . # # # # # . . .
        . . . . . . # # # # # . . .
        . . . . . . # # # # . . . .
        . . . . . # # # # # . . . .
        . . . . . # # # # # . . . .
        . . . # # # # # # # # . . .
        . . # # # # # # # # # # . .
        . . # # # # # # # # # # . .      
    },
    piece_sprite! {
        . . . . . . # # . . . . . .
        . . . . . . # # . . . . . .
        . . . . . # # # # . . . . .
        . . . . # # # # . # . . . .
        . . . . # # # . # # . . . .
        . . . . # # # # # # . . . .
        . . . . . # # # # . . . . .
        . . . . . # # # # . . . . .
        . . . . . # # # # . . . . .
        . . . . . # # # # . . . . .
        . . . . # # # # # # . . . .
        . . # # # # # # # # # # . .
        . . # # # # # # # # # # . .
        . . # # # # # # # # # # . .  
    },
    piece_sprite! {
        . . # # . # # # # . # # . .
        . . # # . # # # # . # # . .
        . . # # # # # # # # # # . .
        . . # # # # # # # # # # . .
        . . # # # # # # # # # # . .
        . . . . # # # # # # . . . .
        . . . . # # # # # # . . . .
        . . . . # # # # # # . . . .
        . . . . # # # # # # . . . .
        . . . . # # # # # # . . . .
        . . # # # # # # # # # # . .
        . # # # # # # # # # # # # .
        . # # # # # # # # # # # # .
        . # # # # # # # # # # # # .  
    },
    piece_sprite! {
        . . . . . . # # . . . . . .
        . . . . . # # # # . . . . .
        . . . . . . # # . . . . . .
        # . . . . . . . . . . . . #
        # # . . . . # # . . . . # #
        # # # . . # # # # . . # # #
        # # # # . # # # # . # # # #
        # # # # # # # # # # # # # #
        . # # # # # # # # # # # # .
        . . # # # # # # # # # # . .
        . . # # # # # # # # # # . .
        # # # # # # # # # # # # # #
        # # # # # # # # # # # # # #
        # # # # # # # # # # # # # #
    },
    piece_sprite! {
        . . . . . . # # . . . . . .
        . . . # # # # # # # # . . .
        . . . . . . # # . . . . . .
        . . # # # . # # . # # # . .
        . # # # # # # # # # # # # .
        # # # # # # # # # # # # # #
        # # # . . # # # # . . # # #
        # # . . . . # # . . . . # #
        # # # . . . # # . . . # # #
        # # # # # . # # . # # # # #
        . # # # # # # # # # # # # .
        . . . # # # # # # # # . . .
        # # # # # # # # # # # # # #
        . # # # # # # # # # # # # .
    }
];

pub const MOVE_INDICATOR: TwoBppSprite = sprite! {
    (4, 4)
    . @ @ .
    @ # # @
    @ # # @
    . @ @ .
};
